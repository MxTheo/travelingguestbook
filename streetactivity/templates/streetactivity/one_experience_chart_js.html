{% load static %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src={% static "streetactivity/js/colors.js" %}></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const colors = MyColors.getBootstrapColors();

        // Data voorbereiden vanuit Django context
        const moments = {{ moments_json| safe }};

        if (!moments || moments.length === 0) {
            document.querySelector('.chart-container').innerHTML =
                '<p class="text-center text-muted">Hoe is je gevoel van (on)zekerheid verlopen tijdens deze ervaring?</p>';
            return;
        }

        // Labels (activiteit namen) voor x-as
        const labels = moments.map(moment => moment.activity.name);

        // Data points of y-axis
        const confidenceData = moments.map(moment => moment.confidence_level);
        const reportSnippets = moments.map(moment => moment.report_snippet || '');

        // Colors for each datapoint
        const pointColors = MyColors.mapConfidenceLevelsToColors(confidenceData, colors);


        // Canvas element
        const ctx = document.getElementById('confidenceChart').getContext('2d');

        // Chart configuration
        const confidenceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Zelfverzekerdheid',
                    data: confidenceData,
                    borderColor: colors.primary,
                    backgroundColor: colors.dark,
                    pointBackgroundColor: pointColors,
                    pointBorderColor: pointColors,
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    pointBorderWidth: 2,
                    pointHitRadius: 15,
                    fill: false,
                    tension: 0.3  // Maakt de lijn vloeiend
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        min: 0,
                        max: 2,
                        ticks: {
                            stepSize: 1,
                            callback: function (value) {
                                // Converteer numerieke waarde terug naar label
                                switch (value) {
                                    case 0:
                                        return 'Onzeker';
                                    case 1:
                                        return 'Tussenin';
                                    case 2:
                                        return 'Zelfverzekerd';
                                    default:
                                        return '';
                                }
                            }
                        },
                        grid: {
                            drawBorder: true
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            autoSkip: false,
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const index = context.dataIndex;
                                return reportSnippets[index] || '';
                            },
                        }
                    }
                },
                clip: false
            }
        });
    });
</script>
